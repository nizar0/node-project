<app-header></app-header>
<div class="booking-container">
  <h2>Mes R√©servations</h2>

  <div *ngIf="bookings.length === 0" class="no-bookings">
    Vous n'avez aucune r√©servation en cours.
  </div>

  <!-- Booking List -->
  <div class="booking-list">
    <div *ngFor="let booking of bookings" class="booking-card">
      <div class="image-container">
        <!-- Display yacht images dynamically -->
        <img
          [src]="getUrl(booking.yacht.images[currentImageIndex[booking._id]]) || 'assets/default-yacht.jpg'"
          alt="Yacht Image"
          class="yacht-image"
        />
        <!-- Next Button for Image Navigation -->
        <button class="next-btn" (click)="nextImage(booking, $event)">&#10095;</button>
      </div>

      <div class="booking-details">
        <h3>{{ booking.yacht.name }}</h3>
        <p>
          <span class="status" [ngClass]="{
            'pending': booking.status === 'pending',
            'accepted': booking.status === 'accepted',
            'canceled': booking.status === 'canceled',
            'payed': booking.status === 'payed',
            'ongoing': booking.status === 'ongoing',
            'done': booking.status === 'done'
          }">
            {{ booking.status === 'pending' ? 'En attente' :
            booking.status === 'accepted' ? 'Accept√©' :
              booking.status === 'canceled' ? 'Annul√©' :
                booking.status === 'payed' ? 'Pay√©' :
                  booking.status === 'ongoing' ? 'En cours' :
                    booking.status === 'done' ? 'Termin√©' : '' }}
          </span>
        </p>

        <p><strong>Date:</strong> {{ booking.startDate | date:'mediumDate' }} - {{ booking.endDate | date:'mediumDate' }}</p>
        <p><strong>Prix total:</strong> {{ booking.totalPrice }} DT</p>

        <!-- Booking Actions -->
        <div class="booking-actions">
          <button *ngIf="booking.status === 'accepted'" class="pay-button" (click)="paymentModal.openPaymentModal(booking)">Payer</button>
          <button *ngIf="booking.status === 'accepted'" class="cancel-button" (click)="cancelBooking(booking._id)">Annuler</button>
          <p *ngIf="booking.status === 'payed'" class="status-message">‚úÖ Pay√©</p>
          <p *ngIf="booking.status === 'ongoing'" class="status-message">‚è≥ En cours</p>
          <p *ngIf="booking.status === 'done'" class="status-message">üèÅ Termin√©</p>
          <button *ngIf="booking.status === 'done' && !booking.hasReviewed" class="review-button" (click)="goToAddReview(booking._id)">
            ‚≠ê Donner un avis
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-payment-modal #paymentModal></app-payment-modal>
